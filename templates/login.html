{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Kindergarten Schedule Generator</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    {% load static %}
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>


    <!-- Header -->
    <header class="bg-white shadow-sm py-3 mb-4">
        <div class="container">
            <div class="d-flex align-items-center justify-content-between">
                <div class="logo d-flex align-items-center">
                    <i class="fas fa-school text-primary fs-2 me-2"></i>
                    <h1 class="h4 mb-0 text-primary">Kindergarten Schedule Generator</h1>
                </div>
              
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container my-5">
        <div class="auth-card">
            <div class="auth-card-header">
                <i class="fas fa-sign-in-alt"></i>
                <h2>Welcome Back!</h2>
                <p>Sign in to manage your kindergarten schedules</p>
            </div>

            <!-- Success Message (Hidden by default) -->
            <div id="successMessage" class="alert alert-success" style="display: none;">
                <i class="fas fa-check-circle me-2"></i>
                <strong>Success!</strong> You have successfully signed in.
            </div>

            <!-- Info Message (for account created) -->
            <div id="infoMessage" class="alert alert-info" style="display: none;">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Account created!</strong> Please sign in with your credentials.
            </div>

            <!-- Error Message (Hidden by default) -->
            <div id="errorMessage" class="alert alert-danger" style="display: none;">
                <i class="fas fa-exclamation-circle me-2"></i>
                <strong>Error!</strong> <span id="errorText">Invalid email or password.</span>
            </div>

            <form id="loginForm" method="post" novalidate action="{% url 'login' %}">
    {% csrf_token %}
     
  {% if next %}
    <input type="hidden" name="next" value="{{ next }}">
  {% endif %}
    
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    <!-- Email -->
    <div class="mb-3">
        <label for="email" class="form-label">Email Address</label>
        <div class="input-group">
            <span class="input-group-text"><i class="fas fa-envelope"></i></span>
            <input type="email" class="form-control" id="email" name="email" 
                   placeholder="Enter your email" required
                   value="{{ request.POST.email|default:'' }}">
        </div>
        {% if form.email.errors %}
          <div class="text-danger small">{{ form.email.errors.0 }}</div>
        {% endif %}
    </div>

    <!-- Password -->
    <div class="mb-3">
        <label for="password" class="form-label">Password</label>
        <div class="input-group position-relative">
            <span class="input-group-text"><i class="fas fa-lock"></i></span>
            <input type="password" class="form-control" id="password" name="password" 
                   placeholder="Enter your password" required>
            <span class="password-toggle" onclick="togglePassword('password', this)">
                <i class="fas fa-eye"></i>
            </span>
        </div>
        {% if form.password.errors %}
          <div class="text-danger small">{{ form.password.errors.0 }}</div>
        {% endif %}
    </div>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <div class="form-check">
            <input type="checkbox" class="form-check-input" id="rememberMe" name="rememberMe">
            <label class="form-check-label" for="rememberMe">
                Remember me
            </label>
        </div>
        <a href="{% url 'password_reset' %}" class="btn-link small-text">Forgot Password?</a>
    </div>

    <button type="submit" class="btn btn-primary btn-block btn-lg w-100">
        <i class="fas fa-sign-in-alt me-2"></i>Sign In
    </button>

    <div class="auth-links mt-3 text-center">
        <p>Don't have an account? <a href="{% url 'signup' %}">Create one here</a></p>
    </div>
</form>


            
        </div>
    </main>



    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>



    
    <!-- Custom JavaScript -->

<script>
  // Password toggle (keep)
  function togglePassword(fieldId, icon) {
    const passwordField = document.getElementById(fieldId);
    const iconElement = icon.querySelector('i');
    if (passwordField.type === 'password') {
      passwordField.type = 'text';
      iconElement.classList.remove('fa-eye');
      iconElement.classList.add('fa-eye-slash');
    } else {
      passwordField.type = 'password';
      iconElement.classList.remove('fa-eye-slash');
      iconElement.classList.add('fa-eye');
    }
  }

  // Safe login form submit handler: validate but DO NOT prevent a valid submit.
  (function () {
    const form = document.getElementById('loginForm');
    if (!form) return;

    form.addEventListener('submit', function(event) {
      // client-side validation only; do not prevent valid submits
      // Reset visible messages
      document.getElementById('errorMessage').style.display = 'none';
      document.getElementById('successMessage').style.display = 'none';
      document.getElementById('infoMessage').style.display = 'none';

      // Let browser run built-in validation first
      if (!form.checkValidity()) {
        // Invalid: show built-in validation UI and prevent submit
        event.preventDefault();
        event.stopPropagation();
        form.classList.add('was-validated');
        document.getElementById('errorText').textContent = 'Please enter valid credentials.';
        document.getElementById('errorMessage').style.display = 'block';
        window.scrollTo({ top: 0, behavior: 'smooth' });
        return;
      }

      // Valid: allow the form to post to server (do NOT call preventDefault)
      // Optionally disable submit button to prevent double submit:
      const btn = form.querySelector('button[type="submit"]');
      if (btn) {
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Signing in...';
      }

      // Do nothing else â€” server will authenticate and redirect to dashboard on success
    }, { passive: false });
  })();
</script>



    <!-- <script>
        // Password Toggle Function
        function togglePassword(fieldId, icon) {
            const passwordField = document.getElementById(fieldId);
            const iconElement = icon.querySelector('i');
            
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                iconElement.classList.remove('fa-eye');
                iconElement.classList.add('fa-eye-slash');
            } else {
                passwordField.type = 'password';
                iconElement.classList.remove('fa-eye-slash');
                iconElement.classList.add('fa-eye');
            }
        }

        // Check for success message from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('signup') === 'success') {
            document.getElementById('infoMessage').style.display = 'block';
        }

        // Form Validation
        document.getElementById('loginForm').addEventListener('submit', function(event) {
            event.preventDefault();
            event.stopPropagation();

            const form = this;
            
            // Validate form
            if (form.checkValidity()) {
                // Hide error message
                document.getElementById('errorMessage').style.display = 'none';
                document.getElementById('infoMessage').style.display = 'none';
                
                // Show success message
                document.getElementById('successMessage').style.display = 'block';
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                // Simulate redirect to dashboard after 1.5 seconds
                setTimeout(() => {
                    // window.location.href = '/dashboard/';
                    console.log('Redirect to dashboard (disabled for demo)');
                    alert('Login successful! Redirecting to dashboard...');
                }, 1500);
                
                // Reset validation
                form.classList.remove('was-validated');
            } else {
                // Show validation errors
                form.classList.add('was-validated');
                
                // Show error message
                document.getElementById('errorText').textContent = 'Please enter valid credentials.';
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('infoMessage').style.display = 'none';
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });

        // Demo: Simulate invalid credentials (for demonstration)
        // In real Django app, this would be handled server-side
        document.getElementById('loginForm').addEventListener('submit', function(event) {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Example validation (for demo purposes only)
            if (email === 'demo@example.com' && password === 'password123') {
                // Valid credentials (demo)
                console.log('Valid demo credentials');
            }
        });
    </script> -->
</body>
</html>
