<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password - Kindergarten Schedule Generator</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../static/css/style.css">
</head>
<body>
    <!-- Header -->
    <header class="bg-white shadow-sm py-3 mb-4">
        <div class="container">
            <div class="d-flex align-items-center justify-content-between">
                <div class="logo d-flex align-items-center">
                    <i class="fas fa-school text-primary fs-2 me-2"></i>
                    <h1 class="h4 mb-0 text-primary">Kindergarten Schedule Generator</h1>
                </div>
                <nav class="d-none d-md-block">
                    <a href="login.html" class="text-decoration-none text-secondary me-3">Login</a>
                    <a href="signup.html" class="btn btn-primary btn-sm">Sign Up</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container my-5">
        <div class="auth-card">
            <div class="auth-card-header">
                <i class="fas fa-lock-open"></i>
                <h2>Reset Your Password</h2>
                <p>Create a new password for your account</p>
            </div>

            <!-- Success Message (Hidden by default) -->
            <div id="successMessage" class="alert alert-success" style="display: none;">
                <i class="fas fa-check-circle me-2"></i>
                <strong>Password Updated!</strong> Your password has been successfully reset.
            </div>

            <!-- Error Message (Hidden by default) -->
            <div id="errorMessage" class="alert alert-danger" style="display: none;">
                <i class="fas fa-exclamation-circle me-2"></i>
                <strong>Error!</strong> <span id="errorText">Please check the form and try again.</span>
            </div>

            <!-- Warning for expired token -->
            <div id="expiredMessage" class="alert alert-warning" style="display: none;">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>Link Expired!</strong> This password reset link has expired. 
                <a href="forgot_password.html">Request a new one</a>
            </div>

            <form id="resetPasswordForm" novalidate>
                <!-- New Password -->
                <div class="mb-3">
                    <label for="newPassword" class="form-label">New Password</label>
                    <div class="input-group position-relative">
                        <span class="input-group-text"><i class="fas fa-lock"></i></span>
                        <input type="password" class="form-control" id="newPassword" name="newPassword" 
                               placeholder="Enter new password" required minlength="8">
                        <span class="password-toggle" onclick="togglePassword('newPassword', this)">
                            <i class="fas fa-eye"></i>
                        </span>
                    </div>
                    <div class="invalid-feedback">Password must be at least 8 characters long.</div>
                    <small class="text-muted">Minimum 8 characters, including letters and numbers</small>
                </div>

                <!-- Password Strength Indicator -->
                <div class="mb-3">
                    <div class="progress" style="height: 8px; border-radius: 10px;">
                        <div id="passwordStrength" class="progress-bar" role="progressbar" 
                             style="width: 0%; background-color: #dc3545;"></div>
                    </div>
                    <small id="strengthText" class="text-muted">Password strength: <span id="strengthLabel">Weak</span></small>
                </div>

                <!-- Confirm New Password -->
                <div class="mb-4">
                    <label for="confirmPassword" class="form-label">Confirm New Password</label>
                    <div class="input-group position-relative">
                        <span class="input-group-text"><i class="fas fa-lock"></i></span>
                        <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" 
                               placeholder="Confirm new password" required>
                        <span class="password-toggle" onclick="togglePassword('confirmPassword', this)">
                            <i class="fas fa-eye"></i>
                        </span>
                    </div>
                    <div class="invalid-feedback">Passwords do not match.</div>
                </div>

                <!-- Password Requirements -->
                <div class="mb-4 p-3 bg-light-blue rounded">
                    <h6 class="mb-2"><i class="fas fa-shield-alt text-primary me-2"></i>Password Requirements:</h6>
                    <ul class="small mb-0 ps-3">
                        <li id="req-length" class="text-muted">At least 8 characters</li>
                        <li id="req-letter" class="text-muted">Contains letters</li>
                        <li id="req-number" class="text-muted">Contains numbers</li>
                    </ul>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="btn btn-primary btn-block btn-lg">
                    <i class="fas fa-check me-2"></i>Reset Password
                </button>
            </form>

            <!-- Back to Login -->
            <div class="auth-links">
                <p>Remember your password? <a href="login.html">Sign in here</a></p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-light text-center py-4 mt-auto">
        <div class="container">
            <p class="text-muted mb-0">&copy; 2024 Kindergarten Schedule Generator. All rights reserved.</p>
            <p class="text-muted small mb-0">Making schedule management fun and easy! ðŸŽ¨</p>
        </div>
    </footer>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        // Password Toggle Function
        function togglePassword(fieldId, icon) {
            const passwordField = document.getElementById(fieldId);
            const iconElement = icon.querySelector('i');
            
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                iconElement.classList.remove('fa-eye');
                iconElement.classList.add('fa-eye-slash');
            } else {
                passwordField.type = 'password';
                iconElement.classList.remove('fa-eye-slash');
                iconElement.classList.add('fa-eye');
            }
        }

        // Password Strength Checker
        function checkPasswordStrength(password) {
            let strength = 0;
            const strengthBar = document.getElementById('passwordStrength');
            const strengthLabel = document.getElementById('strengthLabel');
            
            // Length check
            if (password.length >= 8) strength += 25;
            if (password.length >= 12) strength += 25;
            
            // Character variety checks
            if (/[a-z]/.test(password)) strength += 15;
            if (/[A-Z]/.test(password)) strength += 15;
            if (/[0-9]/.test(password)) strength += 10;
            if (/[^a-zA-Z0-9]/.test(password)) strength += 10;
            
            // Update progress bar
            strengthBar.style.width = strength + '%';
            
            // Update color and label
            if (strength < 30) {
                strengthBar.style.backgroundColor = '#dc3545';
                strengthLabel.textContent = 'Weak';
                strengthLabel.style.color = '#dc3545';
            } else if (strength < 60) {
                strengthBar.style.backgroundColor = '#ffc107';
                strengthLabel.textContent = 'Fair';
                strengthLabel.style.color = '#ffc107';
            } else if (strength < 80) {
                strengthBar.style.backgroundColor = '#0dcaf0';
                strengthLabel.textContent = 'Good';
                strengthLabel.style.color = '#0dcaf0';
            } else {
                strengthBar.style.backgroundColor = '#198754';
                strengthLabel.textContent = 'Strong';
                strengthLabel.style.color = '#198754';
            }
            
            return strength;
        }

        // Update password requirements checklist
        function updateRequirements(password) {
            const reqLength = document.getElementById('req-length');
            const reqLetter = document.getElementById('req-letter');
            const reqNumber = document.getElementById('req-number');
            
            // Length requirement
            if (password.length >= 8) {
                reqLength.innerHTML = '<i class="fas fa-check-circle text-success me-2"></i>At least 8 characters';
                reqLength.classList.remove('text-muted');
                reqLength.classList.add('text-success');
            } else {
                reqLength.innerHTML = 'At least 8 characters';
                reqLength.classList.remove('text-success');
                reqLength.classList.add('text-muted');
            }
            
            // Letter requirement
            if (/[a-zA-Z]/.test(password)) {
                reqLetter.innerHTML = '<i class="fas fa-check-circle text-success me-2"></i>Contains letters';
                reqLetter.classList.remove('text-muted');
                reqLetter.classList.add('text-success');
            } else {
                reqLetter.innerHTML = 'Contains letters';
                reqLetter.classList.remove('text-success');
                reqLetter.classList.add('text-muted');
            }
            
            // Number requirement
            if (/[0-9]/.test(password)) {
                reqNumber.innerHTML = '<i class="fas fa-check-circle text-success me-2"></i>Contains numbers';
                reqNumber.classList.remove('text-muted');
                reqNumber.classList.add('text-success');
            } else {
                reqNumber.innerHTML = 'Contains numbers';
                reqNumber.classList.remove('text-success');
                reqNumber.classList.add('text-muted');
            }
        }

        // Real-time password strength checking
        document.getElementById('newPassword').addEventListener('input', function() {
            const password = this.value;
            checkPasswordStrength(password);
            updateRequirements(password);
        });

        // Real-time password matching validation
        document.getElementById('confirmPassword').addEventListener('input', function() {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = this.value;
            
            if (newPassword !== confirmPassword) {
                this.setCustomValidity('Passwords do not match');
            } else {
                this.setCustomValidity('');
            }
        });

        // Form Validation
        document.getElementById('resetPasswordForm').addEventListener('submit', function(event) {
            event.preventDefault();
            event.stopPropagation();

            const form = this;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const confirmPasswordField = document.getElementById('confirmPassword');
            
            // Check if passwords match
            if (newPassword !== confirmPassword) {
                confirmPasswordField.setCustomValidity('Passwords do not match');
            } else {
                confirmPasswordField.setCustomValidity('');
            }

            // Additional password requirements validation
            const hasLetter = /[a-zA-Z]/.test(newPassword);
            const hasNumber = /[0-9]/.test(newPassword);
            
            if (!hasLetter || !hasNumber) {
                document.getElementById('errorText').textContent = 'Password must contain both letters and numbers.';
                document.getElementById('errorMessage').style.display = 'block';
                window.scrollTo({ top: 0, behavior: 'smooth' });
                return;
            }

            // Validate form
            if (form.checkValidity()) {
                // Hide error message
                document.getElementById('errorMessage').style.display = 'none';
                
                // Show success message
                document.getElementById('successMessage').style.display = 'block';
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                // Simulate redirect to login page after 2 seconds
                setTimeout(() => {
                    // window.location.href = 'login.html?reset=success';
                    console.log('Redirect to login page (disabled for demo)');
                    alert('Password reset successful! Redirecting to login...');
                }, 2000);
                
                // Reset form
                form.reset();
                form.classList.remove('was-validated');
            } else {
                // Show validation errors
                form.classList.add('was-validated');
                
                // Show error message
                document.getElementById('errorText').textContent = 'Please check the form and try again.';
                document.getElementById('errorMessage').style.display = 'block';
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });

        // Check for expired token (simulated)
        // In real Django app, this would be checked server-side
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');
        
        // Simulate token validation
        if (token === 'expired') {
            document.getElementById('expiredMessage').style.display = 'block';
            document.getElementById('resetPasswordForm').style.display = 'none';
        }
    </script>
</body>
</html>
